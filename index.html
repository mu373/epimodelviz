<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compartment Model Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-6 py-4">
            <h1 class="text-2xl font-semibold text-gray-900">Compartment Model Visualizer</h1>
            <p class="text-sm text-gray-600 mt-1">Visualize epidemiological compartment models from YAML</p>
        </header>

        <!-- Main Content -->
        <div class="flex-1 flex">
            <!-- Sidebar -->
            <div class="w-80 bg-white border-r border-gray-200 p-6 overflow-y-auto">
                <!-- File Input Section -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Input YAML</h3>
                    <label class="block">
                        <input type="file" id="file-input" accept=".yaml,.yml" class="hidden">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-gray-400 transition-colors">
                            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600">Click to upload YAML file</p>
                        </div>
                    </label>
                </div>

                <!-- Text Input Section -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Or paste YAML directly</h3>
                    <textarea id="yaml-input" 
                        class="w-full h-48 p-3 border border-gray-300 rounded-lg text-sm font-mono focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        placeholder="Paste YAML content here..."></textarea>
                    <div class="mt-3 flex gap-2">
                        <button onclick="parseYAML()" 
                            class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            Visualize
                        </button>
                        <button onclick="loadSample()" 
                            class="flex-1 bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                            Load Sample
                        </button>
                    </div>
                </div>

                <!-- Display Options -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Display Options</h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="show-spontaneous" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Show spontaneous transitions</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="show-mediated" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Show mediated transitions</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="show-vaccination" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Show vaccination transitions</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="show-labels" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Show rate labels</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="show-mediators" checked class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-gray-700">Show mediator connections</span>
                        </label>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">Model Statistics</h3>
                    <div class="bg-gray-50 rounded-lg p-3 text-sm space-y-1" id="stats">
                        <div class="text-gray-600">Compartments: <span class="font-medium text-gray-900">-</span></div>
                        <div class="text-gray-600">Transitions: <span class="font-medium text-gray-900">-</span></div>
                        <div class="text-gray-600">Parameters: <span class="font-medium text-gray-900">-</span></div>
                    </div>
                </div>

                <!-- Error Display -->
                <div id="error-container"></div>
            </div>

            <!-- Visualization Area -->
            <div class="flex-1 bg-white">
                <!-- Toolbar -->
                <div class="border-b border-gray-200 px-6 py-3 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <select id="layout-select" onchange="changeLayout()"
                            class="border border-gray-300 rounded-lg px-3 py-1.5 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="hierarchical">Hierarchical Layout</option>
                            <option value="force">Force-Directed</option>
                            <option value="circular">Circular</option>
                        </select>
                        <button onclick="showColumnOrderDialog()"
                            class="px-3 py-1.5 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                            Column Order
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="resetZoom()"
                            class="px-3 py-1.5 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                            Reset View
                        </button>
                        <button onclick="exportSVG()"
                            class="px-3 py-1.5 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                            Export SVG
                        </button>
                    </div>
                </div>

                <!-- Graph Container -->
                <div id="graph-container" class="relative w-full" style="height: calc(100vh - 180px);">
                    <div class="absolute inset-0 flex items-center justify-center text-gray-400" id="empty-state">
                        <div class="text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <p class="mt-2 text-sm">No model loaded</p>
                            <p class="text-xs text-gray-500 mt-1">Upload a YAML file or paste content to visualize</p>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="absolute bottom-4 right-4 bg-white rounded-lg shadow-lg p-3 text-xs" id="legend" style="display: none;">
                    <div class="font-medium text-gray-900 mb-2">Transition Types</div>
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <svg width="30" height="2"><line x1="0" y1="1" x2="30" y2="1" stroke="#6b7280" stroke-width="2"/></svg>
                            <span class="text-gray-600">Spontaneous</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg width="30" height="2"><line x1="0" y1="1" x2="30" y2="1" stroke="#f59e0b" stroke-width="2" stroke-dasharray="4,2"/></svg>
                            <span class="text-gray-600">Mediated</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg width="30" height="2"><line x1="0" y1="1" x2="30" y2="1" stroke="#644391" stroke-width="3"/></svg>
                            <span class="text-gray-600">Vaccination</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <svg width="30" height="10">
                                <rect x="0" y="3" width="20" height="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="0.5" rx="1"/>
                                <line x1="10" y1="3" x2="10" y2="0" stroke="#f59e0b" stroke-width="1" marker-end="url(#arrow-legend)"/>
                                <defs><marker id="arrow-legend" viewBox="0 -2 4 4" refX="2" refY="0" markerWidth="3" markerHeight="3" orient="auto">
                                    <path d="M0,-2L4,0L0,2" fill="#f59e0b"/>
                                </marker></defs>
                            </svg>
                            <span class="text-gray-600">Mediator influence</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="absolute hidden bg-gray-900 text-white text-xs rounded-lg px-3 py-2 pointer-events-none z-50"></div>

    <!-- Column Order Dialog -->
    <div id="column-order-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Column Order</h3>
                <button onclick="closeColumnOrderDialog()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="mb-4">
                <p class="text-sm text-gray-600 mb-3">Use up/down arrows to reorder columns:</p>
                <div id="column-list" class="space-y-2">
                    <!-- Column items will be populated here -->
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="resetColumnOrder()"
                    class="px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                    Reset to Default
                </button>
                <button onclick="applyColumnOrder()"
                    class="px-4 py-2 text-sm text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

</body>
</html>